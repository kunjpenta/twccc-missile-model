<!-- templates/scenarios/assumptions.html -->

{% extends "base.html" %}
{% load static %}

{% block title %}Assumptions · {{ scenario.name }}{% endblock %}

{% block content %}
<div class="card">
  <h2 style="margin:0 0 8px;">Scenario Assumptions — {{ scenario.name }}</h2>

  {# flash messages #}
  {% if messages %}
    <ul class="messages" style="list-style:none; padding:0; margin:0 0 12px;">
      {% for message in messages %}
        <li style="padding:8px 10px; border-radius:8px; margin-bottom:6px; background:#10141c; color:#e7e9ee; border:1px solid #22293a;">
          {{ message }}
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {# form-level errors #}
  {% if form.non_field_errors %}
    <div class="errorlist" style="margin:0 0 12px; color:#e74c3c;">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}

    <div class="grid-3" style="gap:12px; margin-top:8px;">
      <!-- Column 1: Ranges & Tick -->
      <div>
        <h5 style="margin:8px 0;">Ranges & Tick</h5>

        <label for="{{ form.R_W_m.id_for_label }}">Weapon Range (m)</label>
        {{ form.R_W_m }}
        {% if form.R_W_m.errors %}
          <div class="errorlist" style="color:#e74c3c;">{{ form.R_W_m.errors }}</div>
        {% endif %}

        <label for="{{ form.R_DA_m.id_for_label }}">DA Radius (m)</label>
        {{ form.R_DA_m }}
        {% if form.R_DA_m.errors %}
          <div class="errorlist" style="color:#e74c3c;">{{ form.R_DA_m.errors }}</div>
        {% endif %}

        <label for="{{ form.tick_s.id_for_label }}">Tick (s)</label>
        {{ form.tick_s }}
        {% if form.tick_s.errors %}
          <div class="errorlist" style="color:#e74c3c;">{{ form.tick_s.errors }}</div>
        {% endif %}
      </div>

      <!-- Column 2: Weights -->
      <div>
        <h5 style="margin:8px 0;">Weights (sum = 1.0)</h5>

        <label for="{{ form.w_cpa.id_for_label }}">CPA</label>
        {{ form.w_cpa }}
        {% if form.w_cpa.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.w_cpa.errors }}</div>{% endif %}

        <label for="{{ form.w_tcpa.id_for_label }}">TCPA</label>
        {{ form.w_tcpa }}
        {% if form.w_tcpa.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.w_tcpa.errors }}</div>{% endif %}

        <label for="{{ form.w_tdb.id_for_label }}">TDB</label>
        {{ form.w_tdb }}
        {% if form.w_tdb.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.w_tdb.errors }}</div>{% endif %}

        <label for="{{ form.w_twrp.id_for_label }}">TWRP</label>
        {{ form.w_twrp }}
        {% if form.w_twrp.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.w_twrp.errors }}</div>{% endif %}

        <div class="muted" style="margin-top:6px">Weights must sum to 1.0</div>
      </div>

      <!-- Column 3: Sigmas -->
      <div>
        <h5 style="margin:8px 0;">Sigmas (optional)</h5>

        <label for="{{ form.sigma_cpa.id_for_label }}">σ CPA</label>
        {{ form.sigma_cpa }}
        {% if form.sigma_cpa.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.sigma_cpa.errors }}</div>{% endif %}

        <label for="{{ form.sigma_tcpa.id_for_label }}">σ TCPA</label>
        {{ form.sigma_tcpa }}
        {% if form.sigma_tcpa.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.sigma_tcpa.errors }}</div>{% endif %}

        <label for="{{ form.sigma_tdb.id_for_label }}">σ TDB</label>
        {{ form.sigma_tdb }}
        {% if form.sigma_tdb.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.sigma_tdb.errors }}</div>{% endif %}

        <label for="{{ form.sigma_twrp.id_for_label }}">σ TWRP</label>
        {{ form.sigma_twrp }}
        {% if form.sigma_twrp.errors %}<div class="errorlist" style="color:#e74c3c;">{{ form.sigma_twrp.errors }}</div>{% endif %}
      </div>
    </div>

    <div style="display:flex; gap:8px; margin-top:14px;">
      <button class="btn btn-primary" type="submit">Save</button>
      <button class="btn" type="submit" name="compute_now" value="1">Save &amp; Compute Now</button>
      <a class="btn btn-ghost" href="{% url 'tewa:scenario_detail' scenario.id %}">Back</a>
    </div>

    <details style="margin-top:12px;">
      <summary>What do these controls do?</summary>
      <ul style="margin:8px 0 0 18px;">
        <li><strong>R_W_m</strong>: weapon engagement range in meters.</li>
        <li><strong>R_DA_m</strong>: defended-asset radius; should be less than <strong>R_W_m</strong>.</li>
        <li><strong>tick_s</strong>: compute cadence; lower is finer but costlier.</li>
        <li><strong>Weights</strong>: contribution of CPA/TCPA/TDB/TWRP to final score (must sum to 1.0).</li>
        <li><strong>Sigmas</strong>: optional normalization scales; leave blank for defaults.</li>
      </ul>
    </details>
  </form>
</div>
{% endblock %}
